<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.dromara.osc.mapper.ContributionMapper">

    <!-- 查询贡献统计列表（包含成员名称和项目名称） -->
    <select id="selectContributionList" parameterType="org.dromara.osc.domain.Contribution" resultType="org.dromara.osc.domain.vo.ContributionVo">
        SELECT 
            c.contribution_id,
            c.user_id as member_id,
            u.nick_name as member_name,
            c.project_id,
            p.project_name,
            c.contribution_type,
            c.content,
            c.url,
            c.contribution_time,
            c.points,
            c.create_time,
            c.update_time
        FROM os_contribution c
        LEFT JOIN sys_user u ON c.user_id = u.user_id
        LEFT JOIN os_project p ON c.project_id = p.project_id
        <where>
            <if test="memberId != null">
                AND c.user_id = #{memberId}
            </if>
            <if test="memberName != null and memberName != ''">
                AND u.nick_name LIKE CONCAT('%', #{memberName}, '%')
            </if>
            <if test="projectId != null">
                AND c.project_id = #{projectId}
            </if>
            <if test="projectName != null and projectName != ''">
                AND p.project_name LIKE CONCAT('%', #{projectName}, '%')
            </if>
            <if test="contributionType != null and contributionType != ''">
                AND c.contribution_type = #{contributionType}
            </if>
            <if test="content != null and content != ''">
                AND c.content LIKE CONCAT('%', #{content}, '%')
            </if>
            <if test="params.beginTime != null and params.beginTime != ''">
                AND c.contribution_time >= #{params.beginTime}
            </if>
            <if test="params.endTime != null and params.endTime != ''">
                AND c.contribution_time &lt;= #{params.endTime}
            </if>
        </where>
        ORDER BY c.contribution_time DESC
    </select>

</mapper>
