<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.dromara.osc.mapper.ProjectPhaseMapper">

    <resultMap type="org.dromara.osc.domain.vo.ProjectPhaseVo" id="ProjectPhaseResult">
        <result property="phaseId" column="phase_id"/>
        <result property="projectId" column="project_id"/>
        <result property="projectName" column="project_name"/>
        <result property="phaseName" column="phase_name"/>
        <result property="phaseCode" column="phase_code"/>
        <result property="description" column="description"/>
        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>
        <result property="actualStartTime" column="actual_start_time"/>
        <result property="actualEndTime" column="actual_end_time"/>
        <result property="status" column="status"/>
        <result property="progress" column="progress"/>
        <result property="ownerId" column="owner_id"/>
        <result property="ownerName" column="owner_name"/>
        <result property="priority" column="priority"/>
        <result property="createDept" column="create_dept"/>
        <result property="createBy" column="create_by"/>
        <result property="createTime" column="create_time"/>
        <result property="updateBy" column="update_by"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <sql id="selectProjectPhaseVo">
        select pp.phase_id, pp.project_id, pp.phase_name, pp.phase_code, pp.description, 
               pp.start_time, pp.end_time, pp.actual_start_time, pp.actual_end_time,
               pp.status, pp.progress, pp.owner_id, pp.priority, 
               pp.create_dept, pp.create_by, pp.create_time, pp.update_by, pp.update_time,
               p.project_name,
               u.nick_name as owner_name
        from os_project_phase pp
        left join os_project p on pp.project_id = p.project_id
        left join sys_user u on pp.owner_id = u.user_id
    </sql>

    <select id="queryList" parameterType="org.dromara.osc.domain.bo.ProjectPhaseBo" resultMap="ProjectPhaseResult">
        <include refid="selectProjectPhaseVo"/>
        <where>
            <if test="bo.projectId != null">
                AND pp.project_id = #{bo.projectId}
            </if>
            <if test="bo.phaseName != null and bo.phaseName != ''">
                AND pp.phase_name like concat('%', #{bo.phaseName}, '%')
            </if>
            <if test="bo.status != null and bo.status != ''">
                AND pp.status = #{bo.status}
            </if>
            <if test="bo.priority != null">
                AND pp.priority = #{bo.priority}
            </if>
        </where>
        order by pp.create_time desc
    </select>

    <select id="queryPageList" parameterType="org.dromara.osc.domain.bo.ProjectPhaseBo" resultMap="ProjectPhaseResult">
        <include refid="selectProjectPhaseVo"/>
        <where>
            <if test="bo.projectId != null">
                AND pp.project_id = #{bo.projectId}
            </if>
            <if test="bo.phaseName != null and bo.phaseName != ''">
                AND pp.phase_name like concat('%', #{bo.phaseName}, '%')
            </if>
            <if test="bo.status != null and bo.status != ''">
                AND pp.status = #{bo.status}
            </if>
            <if test="bo.priority != null">
                AND pp.priority = #{bo.priority}
            </if>
        </where>
        order by pp.create_time desc
    </select>

    <select id="queryById" parameterType="Long" resultMap="ProjectPhaseResult">
        <include refid="selectProjectPhaseVo"/>
        where pp.phase_id = #{phaseId}
    </select>

    <select id="queryByProjectId" parameterType="Long" resultMap="ProjectPhaseResult">
        <include refid="selectProjectPhaseVo"/>
        where pp.project_id = #{projectId}
        order by pp.create_time desc
    </select>

</mapper>